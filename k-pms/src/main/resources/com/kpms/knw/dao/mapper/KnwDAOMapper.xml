<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Knw">

	<insert id="createOneKnw"
			parameterType="com.kpms.knw.vo.KnwVO">
		INSERT INTO KNW
		 (KNW_ID
		, CRT_DT
		, CRTR
		, MDFY_DT
		, MDFYR
		, USE_YN
		, DEL_YN
		, TTL
		, CNTNT
		, VW_CNT
		, PRJ_ID)
		VALUES
		 ('KNW-' || TO_CHAR(SYSDATE, 'YYYYMMDD') || '-' || LPAD(SEQ_KNW_PK.NEXTVAL, 5, '0')
		, SYSDATE
		, #{crtr}
		, SYSDATE
		, #{mdfyr}
		, NVL(#{useYn}, 'N')
		, 'N'
		, #{ttl}
		, #{cntnt}
		, '0'
		, #{prjId})
	</insert>
	
	
	<select id="readAllKnw"
			parameterType="com.kpms.knw.vo.KnwVO"
			resultType="com.kpms.knw.vo.KnwVO">
		SELECT K.KNW_ID
             , TO_CHAR(K.CRT_DT, 'YYYY-MM-DD HH24:MI:SS') CRT_DT
             , K.CRTR
             , TO_CHAR(K.MDFY_DT, 'YYYY-MM-DD HH24:MI:SS') MDFY_DT
             , K.MDFYR
             , K.USE_YN
             , K.DEL_YN
             , K.TTL
             , K.CNTNT
             , K.VW_CNT
             , K.PRJ_ID
             , P.PRJ_ID P_PRJ_ID
             , P.PRJ_NM 
          FROM KNW K
         INNER JOIN PRJ P
            ON K.PRJ_ID = P.PRJ_ID
         WHERE K.DEL_YN = 'N'
	</select>
	
	<resultMap id="knwVOMap"
			   type="com.kpms.knw.vo.KnwVO"
			   autoMapping="true">
		<id property="knwId" column="KNW_ID" />
		<association property="prjVO"
					 javaType="com.kpms.prj.vo.PrjVO">
			<id property="prjId" column="P_PRJ_ID" />
			<result property="prjNm" column="PRJ_NM" />
		</association>

	</resultMap>
	
	
	<select id="readOneKnwByKnwId"
			parameterType="string"
			resultMap="knwVOMap">	
			
		SELECT K.KNW_ID
		     , TO_CHAR(K.CRT_DT, 'YYYY-MM-DD HH24:MI:SS') CRT_DT
		     , K.CRTR
		     , TO_CHAR(K.MDFY_DT, 'YYYY-MM-DD HH24:MI:SS') MDFY_DT
		     , K.MDFYR
		     , K.USE_YN
		     , K.DEL_YN
		     , K.TTL
		     , K.CNTNT
		     , K.VW_CNT
		     , K.PRJ_ID
		     , P.PRJ_ID P_PRJ_ID
		     , P.PRJ_NM
		  FROM KNW K
		 INNER JOIN PRJ P
			ON K.PRJ_ID = P.PRJ_ID
		 WHERE K.KNW_ID = #{_parameter}
		 
	</select>
	
	<update id="updateOneKnw"
			parameterType="com.kpms.knw.vo.KnwVO">
		UPDATE KNW
		   SET MDFY_DT = SYSDATE
		     , MDFYR = #{mdfyr}
		     , USE_YN = NVL(#{useYn}, 'N')
		     , TTL = #{ttl}
		     , CNTNT = #{cntnt}
		     , PRJ_ID = #{prjId}
		 WHERE KNW_ID = #{knwId}
	</update>

	<update id="deleteOneKnw"
			parameterType="string">
		UPDATE KNW
		   SET DEL_YN = 'Y'
		 WHERE KNW_ID = #{knwId}
	</update>
	
	<update id="deleteKnwBySelectedKnwId"
			parameterType="arraylist">
		UPDATE KNW
		   SET DEL_YN = 'Y'
		 WHERE KNW_ID IN
		 <foreach collection="list" item="knwId" open="( " close=" )" separator=", ">
			#{knwId}
		</foreach>
	</update>

</mapper>